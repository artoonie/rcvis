{% extends "visualizer/base.html" %}
{% load static %}

{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'visualizer/uploadpage.css' %}">
{% endblock %}

{% block navlinks %}
<li class="nav-item mx-0 mx-lg-1">
  <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/index.html#examples">Sample Elections</a>
</li>
<li class="nav-item mx-0 mx-lg-1">
  <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/index.html#types">Visualization Types</a>
</li>
<li class="nav-item mx-0 mx-lg-1">
  <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/index.html">Home</a>
</li>
{% endblock %}

{% block maincontent %}
<script>
function handleFiles(files)
{
  document.getElementById("selectFileButton").innerHTML = files[0].name
}
</script>

  <header class="masthead bg-primary text-white text-center">
    <div class="container d-flex align-items-center flex-column">
      <!-- Masthead Heading -->
      <h1 class="page-section-heading text-center text-uppercase mb-0">Upload Tabulated Election Results</h1>

      <!-- Icon Divider -->
      <div class="divider-custom divider-light">
        <div class="divider-custom-line"></div>
        <div class="divider-custom-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="divider-custom-line"></div>
      </div>

      <!-- Masthead Subheading -->
      <p class="masthead-subheading font-weight-light mb-0">Accepted formats include JSONs from the
          <a class="text-secondary" href="https://www.rankedchoicevoting.org/universal_rcv_tabulator">Universal RCV Tabulator</a> and
          <a class="text-secondary" href="https://www.opavote.com/methods/ranked-choice-voting">Opavote's Online Elections</a>.
          </p>

    </div>
  </header>

<form action="upload.html" enctype="multipart/form-data" method="post" id="form">
  <section class="page-section">
    <div class="container">

      <!-- Portfolio Section Heading -->
      <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Step 1: File Selection</h2>

      <!-- Icon Divider -->
      <div class="divider-custom">
        <div class="divider-custom-line"></div>
        <div class="divider-custom-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="divider-custom-line"></div>
      </div>

      <!-- Portfolio Grid Items -->
      <div class="row">
		<div class="selectFileButtonWrapper">
			<button id="selectFileButton" class="btn btn-primary btn-xl">Click to select a file</button>
			<input id="uploadFileInput" type="file" class="selectFileDefaultInput" name="rcvJson" accept="application/json"  onchange="handleFiles(this.files)"/>
		</div>
      </div>
    </div>
  </section>
  <section class="page-section bg-primary text-white mb-0" id="examples">
    <div class="container">

      <!-- About Section Heading -->
      <h2 class="page-section-heading text-center text-uppercase text mb-0">Step 2: Customization</h2>

      <!-- Icon Divider -->
      <div class="divider-custom divider-light">
        <div class="divider-custom-line"></div>
        <div class="divider-custom-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="divider-custom-line"></div>
      </div>
      <!-- Portfolio Grid Items -->
      <div class="row">
        <div class="col-lg-12">

    {% csrf_token %}
 	<div class="formArea">
		<button class="collapsible">▶ Global visualization options</button>
		<div class="optionscontent">
			<p class="mt-3">
			<label><input type="checkbox" name="hideDecimals"/> Hide decimal places</label>
			<br/><small>By default, we'll show up to two decimal places.</small></label>
		<br/> <br/>
		<label><input type="checkbox" name="excludeFinalWinnerAndEliminatedCandidate" /> Exclude the final elected and eliminated candidate
			<br/><small>This is useful for in-progress elections to avoid bouncing back and forth</small></label>
			</p>
		</div>

		<button class="collapsible">▶ Bargraph visualization options</button>
		<div class="optionscontent">
			<p class="mt-3">
			<label><input type="checkbox" name="doHideOverflowAndEliminated"/> Hide overflow and eliminated votes</label>
		    <br/> <br/>
			<label><input type="checkbox" name="doUseHorizontalBarGraph"/> Make horizontal instead of vertical</label>
			</p>
		</div>

		<button class="collapsible">▶ Sankey visualization options</button>
		<div class="optionscontent">
			<p class="mt-3">
			<label><input type="checkbox" name="hideSankey"/> Hide the sankey altogether</label>
			</p>
			<p>
			<label><input type="checkbox" name="rotateNames" checked/> Rotate the names of candidates on the top bar</label>
			</p>
			<p>
			<label><input type="checkbox" name="horizontalSankey"/> Make it horizontal (default is vertical)</label>
			</p>
		</div>


		<button class="collapsible">▶ Tabular visualization options</button>
		<div class="optionscontent">
			<p class="mt-3">
			<label><input type="checkbox" name="hideTabular"/> Hide both tabular formats altogether</label>
			</p>
			<p>
			<label><input type="checkbox" name="onlyShowWinnersTabular" checked/> Only show winners, hiding eliminated candidates</label>
			</p>
		</div>
	</div>
    </div>
    </div>
  </section>
  <section class="page-section">
    <div class="container">

      <!-- Portfolio Section Heading -->
      <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Step 3: Upload</h2>

      <!-- Icon Divider -->
      <div class="divider-custom">
        <div class="divider-custom-line"></div>
        <div class="divider-custom-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="divider-custom-line"></div>
      </div>

      <!-- Portfolio Grid Items -->
      <div class="row">
		<div class="col" id="submitDiv">
			<button id="uploadButton" type="submit" class="btn btn-primary btn-xl">Click to run the visualizer</button>
		</div>
      </div>
    </div>
  </section>

  </form>
{% endblock %}


{% block etc %}
<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function(event) {
    event.preventDefault();
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.maxHeight){
      this.innerText = this.innerText.replace('▼', '▶');
      content.style.maxHeight = null;
    } else {
      this.innerText = this.innerText.replace('▶', '▼');
      content.style.maxHeight = content.scrollHeight + "px";
    } 
  });
}
</script>
{% endblock %}
