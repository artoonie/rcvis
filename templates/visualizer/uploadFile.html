{% load static %}

<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151309356-1"></script>
<script>
      window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-151309356-1');
</script>

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Ranked Choice Voting Visualization</title>
{% if offlineMode %}
<script src="{% static 'localdeps/d3.js' %}"></script>
<link rel="stylesheet" href="{% static 'localdeps/bootstrap.min.css' %}" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
{% else %}
<!-- for online use -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.8.0/d3.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
{% endif %}
<link rel="stylesheet" type="text/css" href="{% static 'visualizer/uploadpage.css' %}">
<link rel="shortcut icon" type="image/png" href="{% static 'visualizer/favicon.ico' %}"/>
</head>

<script>
function handleFiles(files)
{
  document.getElementById("selectFileButton").innerHTML = files[0].name
}
</script>

{% block content %}
  <div class="row d-flex justify-content-center">
  <div class=".col-s-2 col-md-7 col-s-2">
  <div class="content">
  <form action="upload.html" enctype="multipart/form-data" method="post" id="form">
    {% csrf_token %}
 	<div class="formArea">
		<button class="collapsible">▶ Global visualization options</button>
		<div class="optionscontent">
			<p>
			<label><input type="checkbox" name="hideDecimals"/> Hide decimal places</label>
			<br/><small>By default, we'll show up to two decimal places.</small></label>
		<br/> <br/>
		<label><input type="checkbox" name="excludeFinalWinnerAndEliminatedCandidate" /> Exclude the final elected and eliminated candidate
			<br/><small>This is useful for in-progress elections to avoid bouncing back and forth</small></label>
			</p>
		</div>

		<button class="collapsible">▶ Bargraph visualization options</button>
		<div class="optionscontent">
			<p>
			<label><input type="checkbox" name="doHideOverflowAndEliminated"/> Hide overflow and eliminated votes</label>
		    <br/> <br/>
			<label><input type="checkbox" name="doUseHorizontalBarGraph"/> Make horizontal instead of vertical</label>
			</p>
		</div>

		<button class="collapsible">▶ Sankey visualization options</button>
		<div class="optionscontent">
			<p>
			<label><input type="checkbox" name="hideSankey"/> Hide the sankey altogether</label>
			</p>
			<p>
			<label><input type="checkbox" name="rotateNames" checked/> Rotate the names of candidates on the top bar</label>
			</p>
			<p>
			<label><input type="checkbox" name="horizontalSankey"/> Rotate the diagram to be horizontal instead of vertical (experimental)</label>
			</p>
		</div>


		<button class="collapsible">▶ Tabular visualization options</button>
		<div class="optionscontent">
			<p>
			<label><input type="checkbox" name="hideTabular"/> Hide both tabular formats altogether</label>
			</p>
			<p>
			<label><input type="checkbox" name="onlyShowWinnersTabular" checked/> Only show winners, hiding eliminated candidates</label>
			</p>
		</div>

        <br/>
		<div class="selectFileButtonWrapper">
			<button id="selectFileButton">Click to select a file</button>
			<input id="uploadFileInput" type="file" class="selectFileDefaultInput" name="rcvJson" accept="application/json"  onchange="handleFiles(this.files)"/>
		</div>
		<div id="submitDiv">
			<button id="uploadButton" type="submit" class="submitButton">Upload</button>
		</div>
	</div>
  </form>
  <div class="row text-left" style="margin-top:30px">
      <div class="col">
          <strong>JSON formats accepted:</strong>
          <br/><a href="https://www.rankedchoicevoting.org/universal_rcv_tabulator">Universal RCV Tabulator</a>
          <br/><a href="https://www.opavote.com/methods/ranked-choice-voting">Opavote's Online Elections</a>
      </div>
      <div class="col">
          <strong>Sample Elections:</strong>
          <br/><a href="/visualize=payson-2019-11-12_13-46-26_summary_1json">2019 Payson City Council Seat 1*</a>
          <br/><a href="/visualize=payson-2019-11-12_13-46-26_summary_2json">2019 Payson City Council Seat 2*</a>
          <br/><a href="/visualize=payson-2019-11-12_13-46-26_summary_3json">2019 Payson City Council Seat 3*</a>
          <br/><a href="/visualize=vineyard-2019-11-12_13-49-22_summary_1json">2019 Vineyard City Council Seat 1*</a>
          <br/><a href="/visualize=vineyard-2019-11-12_13-49-22_summary_2json">2019 Vineyard City Council Seat 2*</a>
          <br/><a href="/visualize=opavote2json">2019 FairVote Primary Poll</a>
          <br/><a href="/visualize=2018_maine_gov_primary_demjson">2018 Maine Gubernatorial Primary</a>
          <br/><a href="/visualize=2015_portland_mayorjson">2015 Portland Mayoral Race</a>
          <br/>
          <br/><small>* Used in November 2019 for <a href="http://utahcounty.gov/Dept/ClerkAud/Elections/ResultsTracking.html">Utah County's Preliminary Election Results</a>. The other elections completed before this visualizer was built</small>.
      </div>
      <div class="col">
      <strong>About:</strong>
          <br/><a href="https://github.com/artoonie/rcvis">Source Code</a>
          <br/><a href="https://github.com/artoonie/rcvis/projects/1">Bug Reports & Feature Requests</a>
          <br/><a href="mailto:team@rcvis.com">team@rcvis.com</a>
      </div>
  </div>

		<br/>
  </div>
  </div>
  </div>
<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function(event) {
    event.preventDefault();
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.maxHeight){
      this.innerText = this.innerText.replace('▼', '▶');
      content.style.maxHeight = null;
    } else {
      this.innerText = this.innerText.replace('▶', '▼');
      content.style.maxHeight = content.scrollHeight + "px";
    } 
  });
}
</script>

  {% if uploaded_file_url %}
    <p>File uploaded at: <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a></p>
  {% endif %}

{% endblock %}
