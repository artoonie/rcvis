{% load static %}
{% load compress %}

{% compress js file %}
<script type="module" src="{% static 'pie/pie-chart.es.js' %}"></script>
{% endcompress %}

<script>

    const electionSummary = JSON.parse(document.getElementById("rawDataId").textContent);

    // Create the pie-chart element
    const pieChart = document.createElement("pie-chart");
    pieChart.setAttribute("electionSummary", JSON.stringify(electionSummary));
    pieChart.requestRoundChange = updateRound;

    // Append it to the div
    document.getElementById("pie-body").appendChild(pieChart);

    trs_createSliderAndTimeline({
      wrapperDivId: 'pie-slider-container',
      numTicks: numRounds,
      tickText: generateTickTexts(numRounds),
      hideActiveTickText: doHideActiveTickText(numRounds),
      sliderValueChanged: updatePieChartRound,
      timelineData: generateTimelineData(humanFriendlyEventsPerRound),
      timelinePeeking: !config.doUseDescriptionInsteadOfTimeline,
      timeBetweenStepsMs: 3000
    });

    function updatePieChartRound(roundNum) {
        pieChart.setAttribute("currentRound", roundNum+1);
    }

    // When the pie chart is animating it knows it is advancing rounds, but to avoid reactive
    // loops it requests to be told the new currentRound rather than using 2-way binding.
    // And we also update the slider state while we're at it.
    function updateRound(roundNum) {
        pieChart.setAttribute("currentRound", roundNum);
        document.getElementById('pie-slider-container').setAttribute('value', roundNum-1);
    }

</script>
